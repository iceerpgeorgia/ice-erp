generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Account {
  id                String  @id
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  User              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@index([userId])
}

model AuditLog {
  id         BigInt   @id @default(autoincrement())
  created_at DateTime @default(now())
  table      String
  record_id  String
  action     String
  user_email String?
  user_id    String?
  changes    Json?

  @@index([table, record_id, created_at])
}

model Entry {
  id        String   @id
  userId    String
  project   String
  hours     Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime
  User      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([userId])
}

model Session {
  id           String   @id
  sessionToken String   @unique
  userId       String
  expires      DateTime
  User         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model User {
  id            String    @id
  name          String?
  email         String?   @unique
  emailVerified DateTime?
  image         String?
  role          String    @default("user")
  isAuthorized  Boolean   @default(false)
  authorizedAt  DateTime?
  authorizedBy  String?
  Account       Account[]
  Entry         Entry[]
  Session       Session[]
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model BankAccount {
  id                         BigInt                       @id @default(autoincrement())
  uuid                       String                       @unique @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  accountNumber              String                       @map("account_number")
  currencyUuid               String                       @map("currency_uuid") @db.Uuid
  isActive                   Boolean                      @default(true) @map("is_active")
  createdAt                  DateTime                     @default(now()) @map("created_at")
  updatedAt                  DateTime                     @map("updated_at")
  bankUuid                   String?                      @map("bank_uuid") @db.Uuid
  balance                    Decimal?                     @db.Decimal(18, 2)
  balanceDate                DateTime?                    @map("balance_date") @db.Date
  parsingSchemeUuid          String?                      @map("parsing_scheme_uuid") @db.Uuid
  rawTableName               String?                      @map("raw_table_name") @db.VarChar(255)
  parsingSchemeId            BigInt?                      @map("parsing_scheme_id")
  bank                       Bank?                        @relation(fields: [bankUuid], references: [uuid])
  currency                   currencies                   @relation(fields: [currencyUuid], references: [uuid])
  consolidatedBankAccounts   ConsolidatedBankAccount[]

  @@unique([accountNumber, currencyUuid])
  @@index([bankUuid])
  @@index([currencyUuid])
  @@index([parsingSchemeId])
  @@map("bank_accounts")
}

model Bank {
  id           BigInt        @id @default(autoincrement())
  uuid         String        @unique @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  bankName     String        @map("bank_name")
  isActive     Boolean       @default(true) @map("is_active")
  createdAt    DateTime      @default(now()) @map("created_at")
  updatedAt    DateTime      @map("updated_at")
  bankAccounts BankAccount[]
  
  @@map("banks")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model bog_gel_raw_893486000 {
  id                     BigInt   @id @default(autoincrement())
  uuid                   String   @db.Uuid
  cancopydocument        String?
  canviewdocument        String?
  canprintdocument       String?
  isreval                String?
  docnomination          String?
  docinformation         String?
  docsrcamt              String?
  docsrcccy              String?
  docdstamt              String?
  docdstccy              String?
  dockey                 String?
  docrecdate             String?
  docbranch              String?
  docdepartment          String?
  docprodgroup           String?
  docno                  String?
  docvaluedate           String?
  docsendername          String?
  docsenderinn           String?
  docsenderacctno        String?
  docsenderbic           String?
  docactualdate          String?
  doccoracct             String?
  doccorbic              String?
  doccorbankname         String?
  entriesid              String?
  doccomment             String?
  ccyrate                String?
  entrypdate             String?
  entrydocno             String?
  entrylacct             String?
  entrylacctold          String?
  entrydbamt             String?
  entrydbamtbase         String?
  entrycramt             String?
  entrycramtbase         String?
  outbalance             String?
  entryamtbase           String?
  entrycomment           String?
  entrydepartment        String?
  entryacctpoint         String?
  docsenderbicname       String?
  docbenefname           String?
  docbenefinn            String?
  docbenefacctno         String?
  docbenefbic            String?
  docbenefbicname        String?
  docpayername           String?
  docpayerinn            String?
  import_batch_id        String?
  import_date            DateTime @default(now()) @db.Timestamp(6)
  is_processed           Boolean  @default(false)
  created_at             DateTime @default(now()) @db.Timestamp(6)
  updated_at             DateTime @default(now()) @db.Timestamp(6)
  counteragent_processed Boolean? @default(false)
  counteragent_inn_blank Boolean? @default(false)
  parsing_rule_dominance Boolean? @default(false)
  parsing_rule_processed Boolean? @default(false)
  payment_id_processed   Boolean? @default(false)
  counteragent_inn       String?
  processing_case        String?
  counteragent_found     Boolean? @default(false)
  counteragent_missing   Boolean? @default(false)
  payment_id_matched     Boolean? @default(false)
  payment_id_conflict    Boolean? @default(false)
  parsing_rule_applied   Boolean? @default(false)
  parsing_rule_conflict  Boolean? @default(false)
  applied_rule_id        Int?
}

model brands {
  id                 BigInt   @id @default(autoincrement())
  uuid               String   @unique @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name               String   @unique
  counteragent_uuids String[] @default([]) @db.Uuid
  is_active          Boolean  @default(true)
  created_at         DateTime @default(now())
  updated_at         DateTime @default(now())
  jobs               jobs[]

  @@index([name], map: "idx_brands_name")
  @@index([uuid], map: "idx_brands_uuid")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model ConsolidatedBankAccount {
  id                        BigInt        @id @default(autoincrement())
  uuid                      String        @unique @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  bankAccountUuid           String        @map("bank_account_uuid") @db.Uuid
  rawRecordUuid             String        @map("raw_record_uuid") @db.Uuid
  transactionDate           String        @map("transaction_date")
  description               String?
  counteragentUuid          String?       @map("counteragent_uuid") @db.Uuid
  projectUuid               String?       @map("project_uuid") @db.Uuid
  financialCodeUuid         String?       @map("financial_code_uuid") @db.Uuid
  accountCurrencyUuid       String        @map("account_currency_uuid") @db.Uuid
  accountCurrencyAmount     Decimal       @map("account_currency_amount") @db.Decimal(20, 2)
  nominalCurrencyUuid       String        @map("nominal_currency_uuid") @db.Uuid
  nominalAmount             Decimal       @map("nominal_amount") @db.Decimal(20, 2)
  createdAt                 DateTime      @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt                 DateTime      @default(now()) @map("updated_at") @db.Timestamp(6)
  processingCase            String?       @map("processing_case")
  counteragentAccountNumber String?       @map("counteragent_account_number")
  paymentId                 String?       @map("payment_id") @db.VarChar(255)
  correctionDate            DateTime?     @map("correction_date") @db.Date
  exchangeRate              Decimal?      @map("exchange_rate") @db.Decimal(20, 10)
  bankAccount               BankAccount   @relation(fields: [bankAccountUuid], references: [uuid])

  @@index([bankAccountUuid], map: "idx_consolidated_bank_account_uuid")
  @@index([correctionDate], map: "idx_consolidated_correction_date")
  @@index([counteragentUuid], map: "idx_consolidated_counteragent_uuid")
  @@index([paymentId], map: "idx_consolidated_payment_id")
  @@index([processingCase], map: "idx_consolidated_processing_case")
  @@index([projectUuid], map: "idx_consolidated_project_uuid")
  @@index([rawRecordUuid], map: "idx_consolidated_raw_record_uuid")
  @@index([transactionDate], map: "idx_consolidated_transaction_date")
  
  @@map("consolidated_bank_accounts")
}

model counteragents {
  id                          BigInt         @id @default(autoincrement())
  created_at                  DateTime       @default(now())
  updated_at                  DateTime
  ts                          DateTime       @default(now()) @db.Timestamptz(6)
  name                        String?
  identification_number       String?
  birth_or_incorporation_date DateTime?
  sex                         String?
  address_line_1              String?
  address_line_2              String?
  zip_code                    String?
  iban                        String?
  swift                       String?
  director                    String?
  director_id                 String?
  email                       String?
  phone                       String?
  oris_id                     String?
  country_uuid                String?        @db.Uuid
  entity_type_uuid            String?        @db.Uuid
  counteragent_uuid           String         @unique @db.Uuid
  entity_type                 String?
  country                     String?
  counteragent                String?
  internal_number             String?
  pension_scheme              Boolean?
  is_emploee                  Boolean        @default(false)
  is_active                   Boolean        @default(true)
  was_emploee                 Boolean        @default(false)
  transactions                transactions[]
}

model countries {
  id           BigInt   @id @default(autoincrement())
  created_at   DateTime @default(now())
  updated_at   DateTime
  ts           DateTime @default(now()) @db.Timestamptz(6)
  country_uuid String   @unique @db.Uuid
  name_en      String
  name_ka      String
  iso2         String   @unique @db.Char(2)
  iso3         String   @unique @db.Char(3)
  un_code      Int?
  country      String?
  is_active    Boolean  @default(true)
}

model currencies {
  id            BigInt          @id @default(autoincrement())
  uuid          String          @unique @db.Uuid
  code          String          @unique
  name          String
  is_active     Boolean         @default(true)
  created_at    DateTime        @default(now())
  updated_at    DateTime
  bankAccounts  BankAccount[]
}

model document_types {
  id         BigInt   @id @default(autoincrement())
  uuid       String   @unique @db.Uuid
  name       String   @unique
  is_active  Boolean  @default(true)
  created_at DateTime @default(now())
  updated_at DateTime
}

model entity_types {
  id               BigInt   @id @default(autoincrement())
  created_at       DateTime @default(now())
  updated_at       DateTime
  ts               DateTime @default(now()) @db.Timestamptz(6)
  entity_type_uuid String   @unique @db.Uuid
  code             String   @unique
  name_en          String
  name_ka          String
  is_active        Boolean  @default(true)
}

model financial_codes {
  id            BigInt         @id @default(autoincrement())
  uuid          String         @unique @db.Uuid
  code          String         @unique
  name          String
  validation    String?
  applies_to_pl Boolean        @default(false)
  applies_to_cf Boolean        @default(false)
  is_income     Boolean        @default(false)
  parent_uuid   String?        @db.Uuid
  description   String?
  depth         Int            @default(1)
  sort_order    Int            @default(0)
  is_active     Boolean        @default(true)
  created_at    DateTime       @default(now())
  updated_at    DateTime
  transactions  transactions[]

  @@index([applies_to_cf])
  @@index([applies_to_pl])
  @@index([code])
  @@index([is_active])
  @@index([is_income])
  @@index([parent_uuid])
  @@index([parent_uuid, sort_order])
  @@index([uuid])
}

model jobs {
  id           BigInt   @id @default(autoincrement())
  job_uuid     String   @unique @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  project_uuid String   @db.Uuid
  job_name     String
  floors       Int?
  weight       Int?
  is_ff        Boolean  @default(false)
  is_active    Boolean  @default(true)
  created_at   DateTime @default(now())
  updated_at   DateTime @default(now())
  brand_uuid   String?  @db.Uuid
  brands       brands?  @relation(fields: [brand_uuid], references: [uuid], onDelete: NoAction, onUpdate: NoAction, map: "fk_jobs_brand_uuid")

  @@index([job_uuid], map: "idx_jobs_job_uuid")
  @@index([project_uuid], map: "idx_jobs_project_uuid")
}

model mi_dimensions {
  id         BigInt   @id @default(autoincrement())
  uuid       String   @unique @db.Uuid
  name       String   @unique
  is_active  Boolean  @default(true)
  created_at DateTime @default(now())
  updated_at DateTime
}

model nbg_exchange_rates {
  id         BigInt   @id @default(autoincrement())
  uuid       String   @unique @db.Uuid
  date       DateTime @unique @db.Date
  usd_rate   Decimal? @db.Decimal(18, 6)
  eur_rate   Decimal? @db.Decimal(18, 6)
  cny_rate   Decimal? @db.Decimal(18, 6)
  gbp_rate   Decimal? @db.Decimal(18, 6)
  rub_rate   Decimal? @db.Decimal(18, 6)
  try_rate   Decimal? @db.Decimal(18, 6)
  aed_rate   Decimal? @db.Decimal(18, 6)
  kzt_rate   Decimal? @db.Decimal(18, 6)
  created_at DateTime @default(now())
  updated_at DateTime
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model parsing_scheme_rules {
  id                    BigInt   @id @default(autoincrement())
  scheme_uuid           String   @db.Uuid
  column_name           String?  @db.VarChar(100)
  condition             String
  payment_id            String?  @db.VarChar(255)
  condition_script      String?
  counteragent_uuid     String?  @db.Uuid
  financial_code_uuid   String?  @db.Uuid
  nominal_currency_uuid String?  @db.Uuid
  active                Boolean? @default(true)

  @@index([scheme_uuid])
}

model parsing_schemes {
  scheme String @id @db.VarChar(50)
  uuid   String @unique @default(dbgenerated("gen_random_uuid()")) @db.Uuid
}

model payments {
  id                  BigInt            @id @default(autoincrement())
  project_uuid        String?           @db.Uuid
  counteragent_uuid   String            @db.Uuid
  financial_code_uuid String            @db.Uuid
  job_uuid            String?           @db.Uuid
  payment_id          String            @unique
  record_uuid         String            @unique
  is_active           Boolean           @default(true)
  created_at          DateTime          @default(now())
  updated_at          DateTime
  income_tax          Boolean           @default(false)
  currency_uuid       String            @db.Uuid
  payments_ledger     payments_ledger[]

  @@unique([project_uuid, counteragent_uuid, financial_code_uuid, job_uuid, income_tax, currency_uuid], map: "payments_project_uuid_counteragent_uuid_financial_code_uu_key")
  @@index([counteragent_uuid])
  @@index([currency_uuid])
  @@index([financial_code_uuid])
  @@index([job_uuid])
  @@index([project_uuid])
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model payments_ledger {
  id             BigInt   @id @default(autoincrement())
  payment_id     String
  effective_date DateTime
  accrual        Decimal? @db.Decimal(18, 2)
  order          Decimal? @db.Decimal(18, 2)
  record_uuid    String   @unique @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_email     String
  created_at     DateTime @default(now())
  updated_at     DateTime @default(now())
  comment        String?
  payments       payments @relation(fields: [payment_id], references: [payment_id], onDelete: Cascade, onUpdate: NoAction, map: "fk_payment_ledger_payment")

  @@index([effective_date])
  @@index([payment_id])
}

model project_employees {
  id            BigInt   @id @default(autoincrement())
  project_id    BigInt
  employee_uuid String   @db.Uuid
  employee_name String?
  isActive      Boolean  @default(true)
  assignedAt    DateTime @default(now())
  projects      projects @relation(fields: [project_id], references: [id])

  @@index([employee_uuid])
  @@index([project_id])
}

model project_states {
  id         BigInt   @id @default(autoincrement())
  uuid       String   @unique @db.Uuid
  name       String   @unique
  is_active  Boolean  @default(true)
  created_at DateTime @default(now())
  updated_at DateTime
}

model projects {
  id                  BigInt              @id @default(autoincrement())
  created_at          DateTime            @default(now())
  updated_at          DateTime
  project_uuid        String              @unique @db.Uuid
  counteragent_uuid   String              @db.Uuid
  financial_code_uuid String              @db.Uuid
  currency_uuid       String              @db.Uuid
  state_uuid          String              @db.Uuid
  project_name        String
  date                DateTime            @db.Date
  value               Decimal             @db.Decimal(15, 2)
  oris_1630           String?
  counteragent        String?
  financial_code      String?
  currency            String?
  state               String?
  contract_no         String?
  project_index       String?
  project_employees   project_employees[]

  @@index([counteragent_uuid])
  @@index([currency_uuid])
  @@index([date])
  @@index([financial_code_uuid])
  @@index([state_uuid])
}

model transactions {
  id                String          @id @db.Uuid
  date              DateTime        @db.Date
  amount            Decimal         @db.Decimal(15, 2)
  description       String
  financial_code_id BigInt
  counteragent_id   BigInt?
  created_at        DateTime        @default(now())
  created_by        String?
  updated_at        DateTime
  updated_by        String?
  counteragents     counteragents?  @relation(fields: [counteragent_id], references: [id])
  financial_codes   financial_codes @relation(fields: [financial_code_id], references: [id])

  @@index([counteragent_id])
  @@index([date])
  @@index([financial_code_id, date])
}

model salary_accruals {
  id                    BigInt   @id @default(autoincrement())
  uuid                  String   @unique @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  counteragent_uuid     String   @db.Uuid
  financial_code_uuid   String   @db.Uuid
  nominal_currency_uuid String   @db.Uuid
  payment_id            String   @db.VarChar(100)
  salary_month          DateTime @db.Date
  net_sum               Decimal  @default(0) @db.Decimal(15, 2)
  surplus_insurance     Decimal? @db.Decimal(15, 2)
  deducted_insurance    Decimal? @db.Decimal(15, 2)
  deducted_fitness      Decimal? @db.Decimal(15, 2)
  deducted_fine         Decimal? @db.Decimal(15, 2)
  created_at            DateTime @default(now())
  updated_at            DateTime @default(now())
  created_by            String   @db.VarChar(255)
  updated_by            String   @db.VarChar(255)

  @@index([counteragent_uuid])
  @@index([financial_code_uuid])
  @@index([salary_month])
  @@index([payment_id])
  @@index([nominal_currency_uuid])
  @@index([salary_month, counteragent_uuid])
}
