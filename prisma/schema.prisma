generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(cuid())
  name          String?
  email         String?   @unique
  emailVerified DateTime?
  image         String?
  role          String    @default("user")
  isAuthorized  Boolean   @default(false)
  authorizedAt  DateTime?
  authorizedBy  String?
  accounts      Account[]
  entries       Entry[]
  sessions      Session[]
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@index([userId])
}

model Session {
  id           String   @id
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model Country {
  id           BigInt   @id @default(autoincrement())
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")
  ts           DateTime @default(now()) @db.Timestamptz(6)
  country_uuid String   @unique @default(uuid()) @db.Uuid
  name_en      String
  name_ka      String
  iso2         String   @unique @db.Char(2)
  iso3         String   @unique @db.Char(3)
  un_code      Int?
  country      String?
  is_active    Boolean  @default(true)

  @@map("countries")
}

model Counteragent {
  id                          BigInt        @id @default(autoincrement())
  createdAt                   DateTime      @default(now()) @map("created_at")
  updatedAt                   DateTime      @updatedAt @map("updated_at")
  ts                          DateTime      @default(now()) @db.Timestamptz(6)
  name                        String?
  identification_number       String?
  birth_or_incorporation_date DateTime?
  sex                         String?
  address_line_1              String?
  address_line_2              String?
  zip_code                    String?
  iban                        String?
  swift                       String?
  director                    String?
  director_id                 String?
  email                       String?
  phone                       String?
  oris_id                     String?
  country_uuid                String?       @db.Uuid
  entity_type_uuid            String?       @db.Uuid
  counteragent_uuid           String        @unique @default(uuid()) @db.Uuid
  entity_type                 String?
  country                     String?
  counteragent                String?
  internal_number             String?
  pension_scheme              Boolean?
  is_emploee                  Boolean       @default(false)
  is_active                   Boolean       @default(true)
  was_emploee                 Boolean       @default(false)
  transactions                Transaction[]

  @@map("counteragents")
}

model EntityType {
  id               BigInt   @id @default(autoincrement())
  createdAt        DateTime @default(now()) @map("created_at")
  updatedAt        DateTime @updatedAt @map("updated_at")
  ts               DateTime @default(now()) @db.Timestamptz(6)
  entity_type_uuid String   @unique @db.Uuid
  code             String   @unique
  name_en          String
  name_ka          String
  is_active        Boolean  @default(true)

  @@map("entity_types")
}

model Entry {
  id        String   @id @default(cuid())
  userId    String
  project   String
  hours     Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([createdAt])
}

model AuditLog {
  id        BigInt   @id @default(autoincrement())
  createdAt DateTime @default(now()) @map("created_at")
  table     String
  recordId  String   @map("record_id")
  action    String
  userEmail String?  @map("user_email")
  userId    String?  @map("user_id")
  changes   Json?

  @@index([table, recordId, createdAt])
}

model FinancialCode {
  id           BigInt        @id @default(autoincrement())
  uuid         String        @unique @default(uuid()) @db.Uuid
  code         String        @unique
  name         String
  validation   String?
  appliesToPL  Boolean       @default(false) @map("applies_to_pl")
  appliesToCF  Boolean       @default(false) @map("applies_to_cf")
  isIncome     Boolean       @default(false) @map("is_income")
  parentUuid   String?       @map("parent_uuid") @db.Uuid
  description  String?
  depth        Int           @default(1)
  sortOrder    Int           @default(0) @map("sort_order")
  isActive     Boolean       @default(true) @map("is_active")
  createdAt    DateTime      @default(now()) @map("created_at")
  updatedAt    DateTime      @updatedAt @map("updated_at")
  transactions Transaction[]

  @@index([code])
  @@index([uuid])
  @@index([parentUuid])
  @@index([appliesToPL])
  @@index([appliesToCF])
  @@index([isIncome])
  @@index([parentUuid, sortOrder])
  @@index([isActive])
  @@map("financial_codes")
}

model Transaction {
  id              String        @id @default(uuid()) @db.Uuid
  date            DateTime      @db.Date
  amount          Decimal       @db.Decimal(15, 2)
  description     String
  financialCodeId BigInt        @map("financial_code_id")
  counteragentId  BigInt?       @map("counteragent_id")
  createdAt       DateTime      @default(now()) @map("created_at")
  createdBy       String?       @map("created_by")
  updatedAt       DateTime      @updatedAt @map("updated_at")
  updatedBy       String?       @map("updated_by")
  counteragent    Counteragent? @relation(fields: [counteragentId], references: [id])
  financialCode   FinancialCode @relation(fields: [financialCodeId], references: [id])

  @@index([financialCodeId, date])
  @@index([date])
  @@index([counteragentId])
  @@map("transactions")
}

model Project {
  id                BigInt            @id @default(autoincrement())
  createdAt         DateTime          @default(now()) @map("created_at")
  updatedAt         DateTime          @updatedAt @map("updated_at")
  projectUuid       String            @unique @default(uuid()) @map("project_uuid") @db.Uuid
  counteragentUuid  String            @map("counteragent_uuid") @db.Uuid
  financialCodeUuid String            @map("financial_code_uuid") @db.Uuid
  currencyUuid      String            @map("currency_uuid") @db.Uuid
  stateUuid         String            @map("state_uuid") @db.Uuid
  projectName       String            @map("project_name")
  date              DateTime          @db.Date
  value             Decimal           @db.Decimal(15, 2)
  oris1630          String?           @map("oris_1630")
  counteragent      String?
  financialCode     String?           @map("financial_code")
  currency          String?
  state             String?
  contractNo        String?           @map("contract_no")
  projectIndex      String?           @map("project_index")
  employees         ProjectEmployee[]

  @@index([counteragentUuid])
  @@index([financialCodeUuid])
  @@index([currencyUuid])
  @@index([stateUuid])
  @@index([date])
  @@map("projects")
}

model ProjectEmployee {
  id           BigInt   @id @default(autoincrement())
  projectId    BigInt   @map("project_id")
  employeeUuid String   @map("employee_uuid") @db.Uuid
  employeeName String?  @map("employee_name")
  isActive     Boolean  @default(true)
  assignedAt   DateTime @default(now())
  project      Project  @relation(fields: [projectId], references: [id])

  @@index([projectId])
  @@index([employeeUuid])
  @@map("project_employees")
}

model Currency {
  id           BigInt        @id @default(autoincrement())
  uuid         String        @unique @default(uuid()) @db.Uuid
  code         String        @unique
  name         String
  isActive     Boolean       @default(true) @map("is_active")
  createdAt    DateTime      @default(now()) @map("created_at")
  updatedAt    DateTime      @updatedAt @map("updated_at")
  bankAccounts BankAccount[]

  @@map("currencies")
}

model Bank {
  id           BigInt        @id @default(autoincrement())
  uuid         String        @unique @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  bankName     String        @map("bank_name")
  isActive     Boolean       @default(true) @map("is_active")
  createdAt    DateTime      @default(now()) @map("created_at")
  updatedAt    DateTime      @updatedAt @map("updated_at")
  bankAccounts BankAccount[]

  @@map("banks")
}

model BankAccount {
  id                  BigInt    @id @default(autoincrement())
  uuid                String    @unique @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  accountNumber       String    @map("account_number")
  currencyUuid        String    @map("currency_uuid") @db.Uuid
  isActive            Boolean   @default(true) @map("is_active")
  createdAt           DateTime  @default(now()) @map("created_at")
  updatedAt           DateTime  @updatedAt @map("updated_at")
  bankUuid            String?   @map("bank_uuid") @db.Uuid
  balance             Decimal?  @db.Decimal(18, 2)
  balance_date        DateTime? @db.Date
  parsing_scheme_uuid String?   @db.Uuid
  raw_table_name      String?   @db.VarChar(255)
  parsingSchemeId     BigInt?   @map("parsing_scheme_id")
  bank                Bank?     @relation(fields: [bankUuid], references: [uuid])
  currency            Currency  @relation(fields: [currencyUuid], references: [uuid])
  consolidatedBankAccounts ConsolidatedBankAccount[]

  @@unique([accountNumber, currencyUuid], name: "unique_account_currency")
  @@index([currencyUuid])
  @@index([bankUuid])
  @@index([parsingSchemeId])
  @@map("bank_accounts")
}

model ConsolidatedBankAccount {
  id                    BigInt   @id @default(autoincrement())
  uuid                  String   @unique @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  bankAccountUuid       String   @map("bank_account_uuid") @db.Uuid
  rawRecordUuid         String   @map("raw_record_uuid") @db.Uuid
  transactionDate         String   @map("transaction_date")
  description             String?
  counteragentUuid        String?  @map("counteragent_uuid") @db.Uuid
  counteragentAccountNumber String?  @map("counteragent_account_number")
  projectUuid             String?  @map("project_uuid") @db.Uuid
  financialCodeUuid     String?  @map("financial_code_uuid") @db.Uuid
  accountCurrencyUuid   String   @map("account_currency_uuid") @db.Uuid
  accountCurrencyAmount Decimal  @map("account_currency_amount") @db.Decimal(20, 2)
  nominalCurrencyUuid   String   @map("nominal_currency_uuid") @db.Uuid
  nominalAmount         Decimal  @map("nominal_amount") @db.Decimal(20, 2)
  createdAt             DateTime @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt             DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamp(6)
  processingCase        String?  @map("processing_case")

  // Relations
  bankAccount           BankAccount @relation(fields: [bankAccountUuid], references: [uuid])

  @@index([bankAccountUuid], map: "idx_consolidated_bank_account_uuid")
  @@index([counteragentUuid], map: "idx_consolidated_counteragent_uuid")
  @@index([processingCase], map: "idx_consolidated_processing_case")
  @@index([projectUuid], map: "idx_consolidated_project_uuid")
  @@index([rawRecordUuid], map: "idx_consolidated_raw_record_uuid")
  @@index([transactionDate], map: "idx_consolidated_transaction_date")
  @@map("consolidated_bank_accounts")
}

model NBGExchangeRate {
  id        BigInt   @id @default(autoincrement())
  uuid      String   @unique @default(uuid()) @db.Uuid
  date      DateTime @unique @db.Date
  usdRate   Decimal? @map("usd_rate") @db.Decimal(18, 6)
  eurRate   Decimal? @map("eur_rate") @db.Decimal(18, 6)
  cnyRate   Decimal? @map("cny_rate") @db.Decimal(18, 6)
  gbpRate   Decimal? @map("gbp_rate") @db.Decimal(18, 6)
  rubRate   Decimal? @map("rub_rate") @db.Decimal(18, 6)
  tryRate   Decimal? @map("try_rate") @db.Decimal(18, 6)
  aedRate   Decimal? @map("aed_rate") @db.Decimal(18, 6)
  kztRate   Decimal? @map("kzt_rate") @db.Decimal(18, 6)
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("nbg_exchange_rates")
}

model DocumentType {
  id        BigInt   @id @default(autoincrement())
  uuid      String   @unique @default(uuid()) @db.Uuid
  name      String   @unique
  isActive  Boolean  @default(true) @map("is_active")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("document_types")
}

model ProjectState {
  id        BigInt   @id @default(autoincrement())
  uuid      String   @unique @default(uuid()) @db.Uuid
  name      String   @unique
  isActive  Boolean  @default(true) @map("is_active")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("project_states")
}

model MIDimension {
  id        BigInt   @id @default(autoincrement())
  uuid      String   @unique @default(uuid()) @db.Uuid
  name      String   @unique
  isActive  Boolean  @default(true) @map("is_active")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("mi_dimensions")
}

model Brand {
  id                BigInt   @id @default(autoincrement())
  uuid              String   @unique @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name              String   @unique
  counteragentUuids String[] @default([]) @map("counteragent_uuids") @db.Uuid
  isActive          Boolean  @default(true) @map("is_active")
  createdAt         DateTime @default(now()) @map("created_at")
  updatedAt         DateTime @default(now()) @updatedAt @map("updated_at")
  jobs              Job[]

  @@index([name], map: "idx_brands_name")
  @@index([uuid], map: "idx_brands_uuid")
  @@map("brands")
}

model Job {
  id          BigInt   @id @default(autoincrement())
  jobUuid     String   @unique @default(dbgenerated("gen_random_uuid()")) @map("job_uuid") @db.Uuid
  projectUuid String   @map("project_uuid") @db.Uuid
  jobName     String   @map("job_name")
  floors      Int?
  weight      Int?
  isFf        Boolean  @default(false) @map("is_ff")
  isActive    Boolean  @default(true) @map("is_active")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @default(now()) @updatedAt @map("updated_at")
  brandUuid   String?  @map("brand_uuid") @db.Uuid
  brands      Brand?   @relation(fields: [brandUuid], references: [uuid], onDelete: NoAction, onUpdate: NoAction, map: "fk_jobs_brand_uuid")

  @@index([jobUuid], map: "idx_jobs_job_uuid")
  @@index([projectUuid], map: "idx_jobs_project_uuid")
  @@map("jobs")
}

model Payment {
  id                BigInt          @id @default(autoincrement())
  projectUuid       String?         @map("project_uuid") @db.Uuid
  counteragentUuid  String          @map("counteragent_uuid") @db.Uuid
  financialCodeUuid String          @map("financial_code_uuid") @db.Uuid
  jobUuid           String?         @map("job_uuid") @db.Uuid
  paymentId         String          @unique @map("payment_id")
  recordUuid        String          @unique @map("record_uuid")
  isActive          Boolean         @default(true) @map("is_active")
  createdAt         DateTime        @default(now()) @map("created_at")
  updatedAt         DateTime        @updatedAt @map("updated_at")
  incomeTax         Boolean         @default(false) @map("income_tax")
  currencyUuid      String          @map("currency_uuid") @db.Uuid
  ledgerEntries     PaymentLedger[]

  @@unique([projectUuid, counteragentUuid, financialCodeUuid, jobUuid, incomeTax, currencyUuid], map: "payments_project_uuid_counteragent_uuid_financial_code_uu_key")
  @@index([projectUuid])
  @@index([counteragentUuid])
  @@index([financialCodeUuid])
  @@index([jobUuid])
  @@index([currencyUuid])
  @@map("payments")
}

model PaymentLedger {
  id            BigInt   @id @default(autoincrement())
  paymentId     String   @map("payment_id")
  effectiveDate DateTime @map("effective_date")
  accrual       Decimal? @db.Decimal(18, 2)
  order         Decimal? @map("order") @db.Decimal(18, 2)
  recordUuid    String   @unique @default(dbgenerated("gen_random_uuid()")) @map("record_uuid") @db.Uuid
  userEmail     String   @map("user_email")
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @default(now()) @updatedAt @map("updated_at")
  comment       String?
  payment       Payment  @relation(fields: [paymentId], references: [paymentId], onDelete: Cascade, onUpdate: NoAction, map: "fk_payment_ledger_payment")

  @@index([paymentId])
  @@index([effectiveDate])
  @@map("payments_ledger")
}

model ParsingScheme {
  scheme String @id @db.VarChar(50)
  uuid   String @unique @default(dbgenerated("gen_random_uuid()")) @db.Uuid

  @@map("parsing_schemes")
}

model bog_gel_raw_893486000 {
  id               BigInt   @id @default(autoincrement())
  uuid             String   @db.Uuid
  cancopydocument  String?
  canviewdocument  String?
  canprintdocument String?
  isreval          String?
  docnomination    String?
  docinformation   String?
  docsrcamt        String?
  docsrcccy        String?
  docdstamt        String?
  docdstccy        String?
  dockey           String?
  docrecdate       String?
  docbranch        String?
  docdepartment    String?
  docprodgroup     String?
  docno            String?
  docvaluedate     String?
  docsendername    String?
  docsenderinn     String?
  docsenderacctno  String?
  docsenderbic     String?
  docactualdate    String?
  doccoracct       String?
  doccorbic        String?
  doccorbankname   String?
  entriesid        String?
  doccomment       String?
  ccyrate          String?
  entrypdate       String?
  entrydocno       String?
  entrylacct       String?
  entrylacctold    String?
  entrydbamt       String?
  entrydbamtbase   String?
  entrycramt       String?
  entrycramtbase   String?
  outbalance       String?
  entryamtbase     String?
  entrycomment     String?
  entrydepartment  String?
  entryacctpoint   String?
  docsenderbicname String?
  docbenefname     String?
  docbenefinn      String?
  docbenefacctno   String?
  docbenefbic      String?
  docbenefbicname  String?
  docpayername     String?
  docpayerinn      String?
  import_batch_id  String?
  import_date      DateTime @default(now()) @db.Timestamp(6)
  is_processed     Boolean  @default(false)
  created_at       DateTime @default(now()) @db.Timestamp(6)
  updated_at       DateTime @default(now()) @db.Timestamp(6)
}

model parsing_scheme_rules {
  id                    BigInt  @id @default(autoincrement())
  scheme_uuid           String  @db.Uuid
  column_name           String? @db.VarChar(100)
  condition             String
  payment_id            String? @db.VarChar(255)
  condition_script      String?
  counteragent_uuid     String? @db.Uuid
  financial_code_uuid   String? @db.Uuid
  nominal_currency_uuid String? @db.Uuid

  @@index([scheme_uuid])
}
